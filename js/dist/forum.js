(()=>{var t={96:function(t){t.exports=function(){"use strict";return function(t,n,e){var a="h:mm A",r={lastDay:"[Yesterday at] "+a,sameDay:"[Today at] "+a,nextDay:"[Tomorrow at] "+a,nextWeek:"dddd [at] "+a,lastWeek:"[Last] dddd [at] "+a,sameElse:"MM/DD/YYYY"};n.prototype.calendar=function(t,n){var a=n||this.$locale().calendar||r,o=e(t||void 0).startOf("d"),s=this.diff(o,"d",!0),i="sameElse",c=s<-6?i:s<-1?"lastWeek":s<0?"lastDay":s<1?"sameDay":s<2?"nextDay":s<7?"nextWeek":i,h=a[c]||r[c];return"function"==typeof h?h.call(this,e()):this.format(h)}}}()}},n={};function e(a){var r=n[a];if(void 0!==r)return r.exports;var o=n[a]={exports:{}};return t[a].call(o.exports,o,o.exports,e),o.exports}e.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},e.d=(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},e.o=(t,n)=>Object.prototype.hasOwnProperty.call(t,n),e.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};(()=>{"use strict";e.r(a);const t=flarum.core.compat["forum/app"];var n=e.n(t);const r=flarum.core.compat["common/Model"];var o=e.n(r);const s=flarum.core.compat["common/models/Discussion"];var i=e.n(s);const c=flarum.core.compat["common/models/Post"];var h=e.n(c);const u=flarum.core.compat["common/models/User"];var l=e.n(u);const d=flarum.core.compat["common/models/Forum"];var f=e.n(d);function p(t,n){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},p(t,n)}function v(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,p(t,n)}var g=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(n=t.call.apply(t,[this].concat(a))||this).round_id=o().attribute("round_id"),n.placement=o().attribute("placement"),n.name=o().attribute("name"),n.image_url=o().attribute("image_url"),n.canSee=o().attribute("canSee"),n.canCatch=o().attribute("canCatch"),n.canName=o().attribute("canName"),n.canPlace=o().attribute("canPlace"),n.placeUntil=o().attribute("placeUntil"),n.namedBy=o().hasOne("lastUserNaming"),n.placedBy=o().hasOne("lastUserPlacement"),n.round=o().hasOne("round"),n.placementModel=o().hasOne("placement"),n}return v(n,t),n.prototype.apiEndpoint=function(){return"/catch-the-fish/"+(this.exists?"fishes/"+this.data.id:"rounds/"+this.data.attributes.round_id+"/fishes")},n}(o()),y=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(n=t.call.apply(t,[this].concat(a))||this).catch_count=o().attribute("catch_count"),n.user=o().hasOne("user"),n}return v(n,t),n}(o()),b=function(t){function n(){for(var n,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(n=t.call.apply(t,[this].concat(a))||this).name=o().attribute("name"),n.starts_at=o().attribute("starts_at"),n.ends_at=o().attribute("ends_at"),n.include_starting_pack=o().attribute("include_starting_pack"),n.myRanking=o().hasOne("myRanking"),n}return v(n,t),n.prototype.apiEndpoint=function(){return"/catch-the-fish/rounds"+(this.exists?"/"+this.data.id:"")},n}(o());const k=flarum.core.compat["common/extend"],w=flarum.core.compat["forum/components/HeaderPrimary"];var F=e.n(w);const T=flarum.core.compat["common/utils/extractText"];var _=e.n(T),P="clarkwinkelmann-catch-the-fish.forum.fish-image.",A=function(){function t(){}return t.prototype.view=function(t){var e=t.attrs.fish.image_url();return e?m("img.catchthefish-image",{alt:_()(n().translator.trans(P+"alt",{name:t.attrs.fish.name()})),src:e,style:{animationDuration:t.attrs.animationDuration||"10s"},draggable:!1}):m(".catchthefish-no-image",n().translator.trans(P+"missing"))},t}(),B="clarkwinkelmann-catch-the-fish.forum.basket.",D=function(){function t(){}return t.prototype.view=function(){if(!n().session.user)return m("div");var t=n().session.user.catchTheFishBasket();if(!t)return m("div");var e=t.filter((function(t){return t.canPlace()}));return 0===e.length?m("div"):m(".catchthefish-basket",[m(".catchthefish-basket-title",n().translator.trans(B+"title")),m("p",n().translator.trans(B+"drag-help")),e.map((function(t){return m(".catchthefish-basket-entry",[m(".catchthefish-basket-fish",{draggable:!0,ondragstart:function(e){e.dataTransfer&&(n().draggedFishId=t.id(),e.dataTransfer.setData("text/plain","fish:"+t.id()))}},m(A,{fish:t})),m(".catchthefish-basket-time",n().translator.trans(B+"time",{time:dayjs(t.placeUntil()).fromNow()}))])}))])},t}();const x=flarum.core.compat["forum/components/CommentPost"];var N=e.n(x);const R=flarum.core.compat["forum/components/UserCard"];var O=e.n(R);const M=flarum.core.compat["forum/components/DiscussionHero"];var S=e.n(M),I=function(){function t(){}return t.prototype.view=function(){return m(".catchthefish-drop-area",n().translator.trans("clarkwinkelmann-catch-the-fish.forum.drop-area.message"))},t}();const C=flarum.core.compat["common/utils/classList"];var U=e.n(C);const j=flarum.core.compat["common/components/Modal"];var E=e.n(j);const q=flarum.core.compat["common/components/Button"];var G=e.n(q);const L=flarum.core.compat["common/components/Link"];var Y=e.n(L);const W=flarum.core.compat["common/helpers/avatar"];var z=e.n(W);const H=flarum.core.compat["common/helpers/username"];var J=e.n(H),K=function(){function t(){}return t.prototype.view=function(t){var e=t.attrs.user;return m(Y(),{href:n().route.user(e)},[z()(e)," ",J()(e)])},t}(),Q="clarkwinkelmann-catch-the-fish.forum.caught-fish-modal.",V=function(t){function e(){for(var n,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(n=t.call.apply(t,[this].concat(a))||this).newName=void 0,n.dirty=!1,n.loading=!1,n}v(e,t);var a=e.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.newName=this.attrs.fish.name()},a.className=function(){return"Modal--small catchthefish-catch-modal"},a.title=function(){return n().translator.trans(Q+"title")},a.saveNameAndPlacement=function(t){var e=this;void 0===t&&(t=!1);var a={};this.dirty&&(a.name=this.newName),t&&(a.placement="random"),a?(this.loading=!0,n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/catch-the-fish/fishes/"+this.attrs.fish.id()+"/place",body:a}).then((function(a){n().store.pushPayload(a),e.hide(),e.attrs.fish.canPlace()&&!t&&n().store.find("users",n().session.user.id()).then((function(){m.redraw()}))})).catch((function(t){throw e.loading=!1,m.redraw(),t}))):(this.hide(),this.attrs.fish.canPlace()&&!t&&n().store.find("users",n().session.user.id()).then((function(){m.redraw()})))},a.content=function(){var t,e=this,a=this.attrs.fish,r=a.namedBy(),o=a.placedBy();return m(".Modal-body",[m("h3",'"'+a.name()+'"'),m(A,{fish:a}),r?m("p",[n().translator.trans(Q+"named-by")," ",m(K,{user:r})]):null,o?m("p",[n().translator.trans(Q+"placed-by")," ",m(K,{user:o})]):null,m("p",n().translator.trans(Q+"congratulation",{catch_count:null==(t=a.round().myRanking())?void 0:t.catch_count()})),a.canName()?m(".Form-group",[m("p",n().translator.trans(Q+"name-help")),m("label",n().translator.trans(Q+"name")),m("input.FormControl",{value:this.newName,oninput:function(t){e.newName=t.target.value,e.dirty=!0}})]):null,a.canPlace()?m("p",n().translator.trans(Q+"placement-help")):null,m(".Form-group",G().component({className:"Button Button--primary Button--block",type:"button",loading:this.loading,onclick:function(){e.saveNameAndPlacement()}},n().translator.trans(Q+(this.dirty?a.canPlace()?"submit-name-place-later":"submit-name":a.canPlace()?"submit-place-later":"submit-continue")))),a.canPlace()?m(".Form-group",G().component({className:"Button Button--primary Button--block",type:"button",loading:this.loading,onclick:function(){e.saveNameAndPlacement(!0)}},n().translator.trans(Q+(this.dirty?"submit-name-place-random":"submit-place-random")))):null])},a.onsubmit=function(t){t.preventDefault(),this.saveNameAndPlacement()},e}(E()),X=function(){function t(){this.reverseAnimation=void 0,this.animationDuration=void 0}var e=t.prototype;return e.oninit=function(){this.reverseAnimation=Math.random()>.5,this.animationDuration=5+Math.floor(70*Math.random())/10+"s"},e.view=function(t){var e=t.attrs.fish;return m(".catchthefish-moving-fish",{className:U()({"catchthefish-animate-flip":n().forum.catchTheFishAnimateFlip(),"catchthefish-animate-reverse":this.reverseAnimation}),style:{animationDuration:this.animationDuration},onclick:function(){e.canCatch()||n().session.user?n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/catch-the-fish/fishes/"+e.id()+"/catch",body:e.placement()}).then((function(e){n().modal.show(V,{fish:n().store.pushPayload(e)}),t.attrs.oncatch&&t.attrs.oncatch()})):alert(n().translator.trans("clarkwinkelmann-catch-the-fish.forum.moving-fish.login"))}},[m(".catchthefish-name",e.name()),m(A,{fish:e,animationDuration:this.animationDuration})])},t}();function Z(t){if(!t.dataTransfer)return null;var n=t.dataTransfer.getData("text/plain"),e=/^fish:([0-9]+)$/.exec(n);return e?e[1]:null}function tt(t,n){var e=[];t&&e.push(m(I));var a=n.catchTheFishFishes();return a&&a.forEach((function(t){t.canSee()&&e.push(m(X,{fish:t,oncatch:function(){n.pushData({relationships:{catchTheFishFishes:{data:n.data.relationships.catchTheFishFishes.data.filter((function(n){return n.id!==t.id()}))}}})}}))})),e}function nt(t,e){var a=this;t.ondrop=function(t){a.fishDragOver=!1;var r=n().draggedFishId||Z(t);if(r){t.preventDefault();var o=n().store.getById("catchthefish-fishes",r);if(o){var s={};s[e+"_id"]=a.attrs[e].id(),n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/catch-the-fish/fishes/"+o.id()+"/place",body:{placement:s}}).then((function(t){n().store.pushPayload(t),n().store.find("users",n().session.user.id()).then((function(){m.redraw()}))}))}else alert(n().translator.trans("clarkwinkelmann-catch-the-fish.forum.drop-area.missing-from-store"))}},t.ondragover=function(t){n().draggedFishId||Z(t)?(t.preventDefault(),t.dataTransfer.dropEffect="move",a.fishDragOver?t.redraw=!1:(a.fishDragOver=!0,m.redraw())):(t.dataTransfer&&t.dataTransfer.types.includes("text/plain")&&t.preventDefault(),t.redraw=!1)},t.ondragenter=function(t){t.preventDefault(),t.redraw=!1},t.ondragleave=function(t){a.fishDragOver?(a.fishDragOver=!1,m.redraw()):t.redraw=!1}}function et(t,n,e){"content"===n?(0,k.override)(t,n,(function(t){return t().concat(tt(this.fishDragOver,this.attrs[e]))})):(0,k.extend)(t,n,(function(t){t.add("catchthefish-fish-and-drop",tt(this.fishDragOver,this.attrs[e]))})),(0,k.extend)(t,"oninit",(function(){var t=this;this.fishDragOver=!1,this.subtree&&this.subtree.check((function(){return t.fishDragOver}))})),"content"===n?(0,k.extend)(t,"elementAttrs",(function(t){nt.bind(this)(t,e)})):(0,k.extend)(t,"view",(function(t){t.attrs=t.attrs||{},nt.bind(this)(t.attrs,e)}))}const at=flarum.core.compat["common/components/Page"];var rt=e.n(at),ot="clarkwinkelmann-catch-the-fish.forum.table-ranking.",st=function(){function t(){this.rankings=null}var e=t.prototype;return e.oninit=function(t){var e=this;n().request({method:"GET",url:n().forum.attribute("apiUrl")+"/catch-the-fish/rounds/"+t.attrs.round.id()+"/rankings"}).then((function(t){e.rankings=n().store.pushPayload(t),m.redraw()}))},e.view=function(t){return null===this.rankings?m("p",n().translator.trans(ot+"loading")):m("div",[m("h2",n().translator.trans(ot+"title",{name:t.attrs.round.name()})),m("table.catchthefish-table",[m("thead",m("tr",[m("th",n().translator.trans(ot+"rank")),m("th",n().translator.trans(ot+"count")),m("th",n().translator.trans(ot+"user"))])),m("tbody",this.rankings.map((function(t,n){return m("tr",[m("td","#"+(n+1)),m("td",t.catch_count()),m("td",m(K,{user:t.user()}))])})))])])},t}(),it="clarkwinkelmann-catch-the-fish.forum.page-ranking.",ct=function(t){function e(){return t.apply(this,arguments)||this}return v(e,t),e.prototype.view=function(){if(!n().forum.catchTheFishCanSeeRankingsPage())return m(".container",m("p",n().translator.trans(it+"permission")));var t=n().forum.catchTheFishActiveRounds();return m(".container",[m("h2",n().translator.trans(it+"title")),t?t.map((function(t){return m(st,{round:t})})):m("p",n().translator.trans(it+"nothing"))])},e}(rt());const ht=flarum.core.compat["common/components/LinkButton"];var ut=e.n(ht);const mt=flarum.core.compat["common/components/Switch"];var lt=e.n(mt);const dt=flarum.core.compat["common/utils/withAttr"];var ft=e.n(dt),pt="clarkwinkelmann-catch-the-fish.forum.edit-round.",vt=function(){function t(){this.round=void 0,this.dirty=!1,this.processing=!1}var e=t.prototype;return e.oninit=function(t){var e=t.attrs.round;void 0===e&&(e=n().store.createRecord("catchthefish-rounds",{attributes:{name:"",starts_at:"",ends_at:dayjs().add(1,"day").toISOString(),include_starting_pack:!0}})),this.round=e},e.view=function(t){var e=this;return m("form",{onsubmit:function(n){n.preventDefault(),e.saveRecord(t)}},[m(".Form-group",[m("label",n().translator.trans(pt+"name")),m("input.FormControl",{value:this.round.name(),oninput:ft()("value",this.updateAttribute.bind(this,"name"))}),m(".helpText",n().translator.trans(pt+"name-help"))]),m(".Form-group",[m("label",n().translator.trans(pt+"starts-at")),m("input.FormControl",{value:this.round.starts_at(),oninput:ft()("value",this.updateAttribute.bind(this,"starts_at"))})]),m(".Form-group",[m("label",n().translator.trans(pt+"ends-at")),m("input.FormControl",{value:this.round.ends_at(),oninput:ft()("value",this.updateAttribute.bind(this,"ends_at"))})]),this.round.exists?"":m(".Form-group",[m("label",[lt().component({state:this.round.include_starting_pack(),onchange:this.updateAttribute.bind(this,"include_starting_pack")},n().translator.trans(pt+"starting-pack"))]),m(".helpText",n().translator.trans(pt+"starting-pack-help"))]),m(".ButtonGroup",[G().component({type:"submit",className:"Button Button--primary",loading:this.processing,disabled:!this.readyToSave()},n().translator.trans(pt+(this.round.exists?"save":"create"))),this.round.exists?G().component({type:"button",className:"Button Button--danger",loading:this.processing,onclick:function(){e.deleteRecord(t)}},n().translator.trans(pt+"delete")):""])])},e.updateAttribute=function(t,n){var e;this.round.pushAttributes(((e={})[t]=n,e)),this.dirty=!0},e.readyToSave=function(){return!!this.round.name()&&this.dirty},e.saveRecord=function(t){var n=this;this.processing=!0,this.round.save(this.round.data.attributes).then((function(){t.attrs.onsave&&t.attrs.onsave(),n.processing=!1,n.dirty=!1,m.redraw()})).catch((function(t){throw n.processing=!1,m.redraw(),t}))},e.deleteRecord=function(t){var e=this;confirm(_()(n().translator.trans(pt+"delete-confirmation",{name:this.round.name()})))&&(this.processing=!0,this.round.delete().then((function(){t.attrs.ondelete&&t.attrs.ondelete(),e.processing=!1,m.redraw()})).catch((function(t){throw e.processing=!1,m.redraw(),t})))},t}(),gt=function(t){function e(){return t.apply(this,arguments)||this}v(e,t);var a=e.prototype;return a.className=function(){return"Modal--small"},a.title=function(){return n().translator.trans("clarkwinkelmann-catch-the-fish.forum.new-round-modal.title")},a.content=function(){var t=this;return m(".Modal-body",m(vt,{onsave:function(){t.hide(),t.attrs.oncreateordelete&&t.attrs.oncreateordelete()}}))},e}(E()),yt=function(t){function e(){return t.apply(this,arguments)||this}v(e,t);var a=e.prototype;return a.className=function(){return"Modal--small"},a.title=function(){return n().translator.trans("clarkwinkelmann-catch-the-fish.forum.edit-round-modal.title",{name:this.attrs.round.name()})},a.content=function(){var t=this;return m(".Modal-body",m(vt,{round:this.attrs.round,ondelete:function(){t.hide(),t.attrs.oncreateordelete&&t.attrs.oncreateordelete()}}))},e}(E()),bt="clarkwinkelmann-catch-the-fish.forum.table-round.",kt=function(t){function e(){for(var n,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(n=t.call.apply(t,[this].concat(a))||this).rounds=null,n}v(e,t);var a=e.prototype;return a.oninit=function(n){t.prototype.oninit.call(this,n),this.refreshRounds()},a.refreshRounds=function(){var t=this;this.rounds=null,n().request({method:"GET",url:n().forum.attribute("apiUrl")+"/catch-the-fish/rounds"}).then((function(e){t.rounds=n().store.pushPayload(e),m.redraw()}))},a.view=function(){var t=this;return null===this.rounds?m(".container",m("p",n().translator.trans(bt+"loading"))):m(".container",[m("h2",n().translator.trans(bt+"title")),G().component({className:"Button Button--primary",onclick:function(){n().modal.show(gt,{oncreateordelete:function(){t.refreshRounds()}})}},n().translator.trans(bt+"new")),m("table.catchthefish-table",[m("thead",m("tr",[m("th",n().translator.trans(bt+"name")),m("th",n().translator.trans(bt+"start")),m("th",n().translator.trans(bt+"end")),m("th",n().translator.trans(bt+"actions"))])),m("tbody",this.rounds.map((function(e){return m("tr",[m("td",e.name()),m("td",e.starts_at()),m("td",e.ends_at()),m("td",[G().component({className:"Button",onclick:function(){n().modal.show(yt,{round:e,oncreateordelete:function(){t.refreshRounds()}})}},n().translator.trans(bt+"edit"))," ",ut().component({className:"Button",href:n().route("catchTheFishRound",{id:e.id()})},n().translator.trans(bt+"fishes"))])])})))])])},e}(rt()),wt="clarkwinkelmann-catch-the-fish.forum.edit-fish.",Ft=function(){function t(){this.fish=void 0,this.dirty=!1,this.processing=!1}var e=t.prototype;return e.oninit=function(t){var e=t.attrs.fish;void 0===e&&(e=n().store.createRecord("catchthefish-fishes",{attributes:{round_id:t.attrs.round.id(),name:""}})),this.fish=e},e.view=function(t){var e=this;return m("form",{onsubmit:function(n){n.preventDefault(),e.saveRecord(t)}},[m(".Form-group",[m("label",n().translator.trans(wt+"name")),m("input.FormControl",{value:this.fish.name(),oninput:function(t){e.fish.pushAttributes({name:t.target.value}),e.dirty=!0}}),m(".helpText",n().translator.trans(wt+"name-help"))]),m(".ButtonGroup",[G().component({type:"submit",className:"Button Button--primary",loading:this.processing,disabled:!this.readyToSave()},n().translator.trans(wt+(this.fish.exists?"save":"create"))),this.fish.exists?G().component({type:"button",className:"Button Button--danger",loading:this.processing,onclick:function(){e.deleteRecord(t)}},n().translator.trans(wt+"delete")):""])])},e.readyToSave=function(){return!!this.fish.name()&&this.dirty},e.saveRecord=function(t){var n=this;this.processing=!0,this.fish.save(this.fish.data.attributes).then((function(){t.attrs.onsave&&t.attrs.onsave(),n.processing=!1,n.dirty=!1,m.redraw()})).catch((function(t){throw n.processing=!1,m.redraw(),t}))},e.deleteRecord=function(t){var e=this;confirm(_()(n().translator.trans(wt+"delete-confirmation",{name:this.fish.name()})))&&(this.processing=!0,this.fish.delete().then((function(){t.attrs.ondelete&&t.attrs.ondelete(),e.processing=!1,m.redraw()})).catch((function(t){throw e.processing=!1,m.redraw(),t})))},t}(),Tt=function(t){function e(){return t.apply(this,arguments)||this}v(e,t);var a=e.prototype;return a.className=function(){return"Modal--small"},a.title=function(){return n().translator.trans("clarkwinkelmann-catch-the-fish.forum.new-fish-modal.title")},a.content=function(){var t=this;return m(".Modal-body",m(Ft,{round:this.attrs.round,onsave:function(){t.hide(),t.attrs.oncreateordelete&&t.attrs.oncreateordelete()}}))},e}(E()),_t=function(t){function e(){return t.apply(this,arguments)||this}v(e,t);var a=e.prototype;return a.className=function(){return"Modal--small"},a.title=function(){return n().translator.trans("clarkwinkelmann-catch-the-fish.forum.edit-fish-modal.title",{name:this.attrs.fish.name()})},a.content=function(){var t=this;return m(".Modal-body",m(Ft,{fish:this.attrs.fish,ondelete:function(){t.hide(),t.attrs.oncreateordelete&&t.attrs.oncreateordelete()}}))},e}(E()),Pt="clarkwinkelmann-catch-the-fish.forum.table-fish.",At=function(t){function e(){for(var n,e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return(n=t.call.apply(t,[this].concat(a))||this).roundId=void 0,n.round=null,n.fishes=null,n.uploading=!1,n}v(e,t);var a=e.prototype;return a.oninit=function(e){var a=this;t.prototype.oninit.call(this,e),this.roundId=m.route.param("id"),this.round=n().store.getById("catchthefish-round",this.roundId),this.round||n().store.find("catch-the-fish/rounds",this.roundId).then((function(t){a.round=t,m.redraw()})),this.refreshFishes()},a.refreshFishes=function(){var t=this;this.fishes=null,n().request({method:"GET",url:n().forum.attribute("apiUrl")+"/catch-the-fish/rounds/"+this.roundId+"/fishes"}).then((function(e){t.fishes=n().store.pushPayload(e),m.redraw()}))},a.openPicker=function(t,n){if(void 0===n&&(n=!1),!this.uploading){var e=$('<input type="file">');e.attr("multiple",n),e.appendTo("body").hide().click().on("change",(function(n){t(n.target.files)}))}},a.uploadImages=function(t,e){var a=this,r=new FormData;if(e)r.append("image",t[0]);else for(var o=0;o<t.length;o++)r.append("image"+o,t[o]);this.uploading=!0,m.redraw(),n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/catch-the-fish/"+(e?"fishes/"+e.id()+"/image":"rounds/"+this.roundId+"/fishes-from-images"),serialize:function(t){return t},body:r}).then((function(){a.uploading=!1,m.redraw(),a.refreshFishes()})).catch((function(t){throw a.uploading=!1,m.redraw(),t}))},a.view=function(){var t=this;return this.round&&null!==this.fishes?m(".container",[m("h2",n().translator.trans(Pt+"title",{name:this.round.name()})),G().component({className:"Button Button--primary",onclick:function(){n().modal.show(Tt,{round:t.round,oncreateordelete:function(){t.refreshFishes()}})}},n().translator.trans(Pt+"new"))," ",G().component({className:"Button",type:"button",onclick:function(){t.openPicker((function(n){t.uploadImages(n)}),!0)},loading:this.uploading},n().translator.trans(Pt+"new-from-image")),m("table.catchthefish-table",[m("thead",m("tr",[m("th",n().translator.trans(Pt+"image")),m("th",n().translator.trans(Pt+"name")),m("th",n().translator.trans(Pt+"user-name")),m("th",n().translator.trans(Pt+"user-place")),m("th",n().translator.trans(Pt+"placement")),m("th",n().translator.trans(Pt+"actions"))])),m("tbody",0===this.fishes.length?m("tr",[m("td","No fishes")]):this.fishes.map((function(e){var a=e.namedBy(),r=e.placedBy();return m("tr",[m("td",m(A,{fish:e})),m("td",e.name()),m("td",a?m(K,{user:a}):m("em",n().translator.trans(Pt+"no-user-name"))),m("td",r?m(K,{user:r}):m("em",n().translator.trans(Pt+"no-user-place"))),m("td",t.placement(e)),m("td",[G().component({className:"Button",onclick:function(){n().modal.show(_t,{fish:e,oncreateordelete:function(){t.refreshFishes()}})}},n().translator.trans(Pt+"edit"))," ",G().component({className:"Button",type:"button",onclick:function(){t.openPicker((function(n){t.uploadImages(n,e)}))},loading:t.uploading},n().translator.trans(Pt+"upload"))])])})))])]):m(".container",m("p",n().translator.trans(Pt+"loading")))},a.placement=function(t){var e=t.placementModel();if(e instanceof i())return m(Y(),{href:n().route.discussion(e)},e.title());if(e instanceof h()){var a=e.discussion();return m(Y(),{href:n().route.post(e)},(a?a.title():"")+" #"+e.number())}return e instanceof l()?m(K,{user:e}):"N/A"},e}(rt());const Bt=flarum.core.compat["forum/components/IndexPage"];var Dt=e.n(Bt),xt="clarkwinkelmann-catch-the-fish.forum.nav.",Nt="clarkwinkelmann-catch-the-fish.forum.round-alert.",Rt=function(){function t(){}return t.prototype.view=function(t){return m(".Alert.Alert-info",m(".container",[m("span.Alert-body",[n().translator.trans(Nt+"message",{name:t.attrs.round.name(),time:dayjs(t.attrs.round.ends_at()).calendar()})]),n().forum.catchTheFishCanSeeRankingsPage()?m("ul.Alert-controls",m("li",ut().component({href:n().route("catchTheFishRankings")},n().translator.trans(Nt+"rankings")))):null]))},t}(),Ot=e(96),Mt=e.n(Ot);dayjs.extend(Mt()),n().initializers.add("clarkwinkelmann-catch-the-fish",(function(){n().store.models["catchthefish-fishes"]=g,n().store.models["catchthefish-rankings"]=y,n().store.models["catchthefish-rounds"]=b,i().prototype.catchTheFishFishes=o().hasMany("catchTheFishFishes"),h().prototype.catchTheFishFishes=o().hasMany("catchTheFishFishes"),l().prototype.catchTheFishFishes=o().hasMany("catchTheFishFishes"),l().prototype.catchTheFishBasket=o().hasMany("catchTheFishBasket"),f().prototype.catchTheFishActiveRounds=o().hasMany("catchTheFishActiveRounds"),f().prototype.catchTheFishCanModerate=o().attribute("catchTheFishCanModerate"),f().prototype.catchTheFishCanSeeRankingsPage=o().attribute("catchTheFishCanSeeRankingsPage"),f().prototype.catchTheFishAnimateFlip=o().attribute("catchTheFishAnimateFlip"),(0,k.extend)(F().prototype,"items",(function(t){t.add("catchthefish-basket",m(D))})),et(N().prototype,"content","post"),et(O().prototype,"infoItems","user"),et(S().prototype,"items","discussion"),document.addEventListener("dragend",(function(){n().draggedFishId=null})),n().routes.catchTheFishRankings={path:"/catch-the-fish",component:ct},n().routes.catchTheFishRounds={path:"/catch-the-fish/rounds",component:kt},n().routes.catchTheFishRound={path:"/catch-the-fish/rounds/:id",component:At},(0,k.extend)(Dt().prototype,"navItems",(function(t){n().forum.catchTheFishCanSeeRankingsPage()&&t.add("catchthefish-rankings",ut().component({icon:"fas fa-fish",href:n().route("catchTheFishRankings")},n().translator.trans(xt+"rankings"))),n().forum.catchTheFishCanModerate()&&t.add("catchthefish-settings",ut().component({icon:"fas fa-fish",href:n().route("catchTheFishRounds")},n().translator.trans(xt+"settings")))})),(0,k.override)(Dt().prototype,"hero",(function(t){var e=t();if(!n().forum.attribute("catchTheFishAlertRound"))return e;var a=n().forum.catchTheFishActiveRounds();if(!a)return e;var r=a.map((function(t){return t?m(Rt,{round:t}):null}));return Array.isArray(e)?a.concat(e):m("div",[r,e])}))}))})(),module.exports=a})();
//# sourceMappingURL=forum.js.map