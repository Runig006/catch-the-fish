module.exports=function(t){var a={};function n(e){if(a[e])return a[e].exports;var r=a[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=a,n.d=function(t,a,e){n.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,a){if(1&a&&(t=n(t)),8&a)return t;if(4&a&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var r in t)n.d(e,r,function(a){return t[a]}.bind(null,r));return e},n.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(a,"a",a),a},n.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},n.p="",n(n.s=27)}([function(t,a){t.exports=flarum.core.compat.app},function(t,a){t.exports=flarum.core.compat.Model},function(t,a,n){"use strict";function e(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a}n.d(a,"a",(function(){return e}))},function(t,a){t.exports=flarum.core.compat["components/Button"]},function(t,a){t.exports=flarum.core.compat.extend},function(t,a){t.exports=flarum.core.compat["components/Modal"]},function(t,a){t.exports=flarum.core.compat["components/LinkButton"]},function(t,a){t.exports=flarum.core.compat["utils/extractText"]},function(t,a){t.exports=flarum.core.compat["components/Page"]},function(t,a){t.exports=flarum.core.compat["components/Switch"]},function(t,a){t.exports=flarum.core.compat["models/Forum"]},function(t,a){t.exports=flarum.core.compat["components/IndexPage"]},function(t,a){t.exports=flarum.core.compat["utils/withAttr"]},function(t,a){t.exports=flarum.core.compat["models/User"]},function(t,a){t.exports=flarum.core.compat["models/Discussion"]},function(t,a){t.exports=flarum.core.compat["models/Post"]},function(t,a){t.exports=flarum.core.compat["components/HeaderPrimary"]},function(t,a){t.exports=flarum.core.compat["components/CommentPost"]},function(t,a){t.exports=flarum.core.compat["components/UserCard"]},function(t,a){t.exports=flarum.core.compat["components/DiscussionHero"]},function(t,a){t.exports=flarum.core.compat["utils/classList"]},function(t,a){t.exports=flarum.core.compat["components/Link"]},function(t,a){t.exports=flarum.core.compat["helpers/avatar"]},function(t,a){t.exports=flarum.core.compat["helpers/username"]},function(t,a,n){t.exports=function(){"use strict";return function(t,a,n){var e="h:mm A",r={lastDay:"[Yesterday at] "+e,sameDay:"[Today at] "+e,nextDay:"[Tomorrow at] "+e,nextWeek:"dddd [at] "+e,lastWeek:"[Last] dddd [at] "+e,sameElse:"MM/DD/YYYY"};a.prototype.calendar=function(t,a){var e=a||this.$locale().calendar||r,o=n(t||void 0).startOf("d"),i=this.diff(o,"d",!0),s=i<-6?"sameElse":i<-1?"lastWeek":i<0?"lastDay":i<1?"sameDay":i<2?"nextDay":i<7?"nextWeek":"sameElse",c=e[s]||r[s];return"function"==typeof c?c.call(this,n()):this.format(c)}}}()},,,function(t,a,n){"use strict";n.r(a);var e=n(0),r=n.n(e),o=n(1),i=n.n(o),s=n(14),c=n.n(s),u=n(15),h=n.n(u),l=n(13),f=n.n(l),d=n(10),p=n.n(d);function g(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var y=n(2);function v(t,a,n){return a in t?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,t}var b=function(t){function a(){for(var a,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return v(g(a=t.call.apply(t,[this].concat(e))||this),"round_id",i.a.attribute("round_id")),v(g(a),"placement",i.a.attribute("placement")),v(g(a),"name",i.a.attribute("name")),v(g(a),"image_url",i.a.attribute("image_url")),v(g(a),"canSee",i.a.attribute("canSee")),v(g(a),"canCatch",i.a.attribute("canCatch")),v(g(a),"canName",i.a.attribute("canName")),v(g(a),"canPlace",i.a.attribute("canPlace")),v(g(a),"placeUntil",i.a.attribute("placeUntil")),v(g(a),"namedBy",i.a.hasOne("lastUserNaming")),v(g(a),"placedBy",i.a.hasOne("lastUserPlacement")),v(g(a),"round",i.a.hasOne("round")),a}return Object(y.a)(a,t),a.prototype.apiEndpoint=function(){return"/catch-the-fish/"+(this.exists?"fishes/"+this.data.id:"rounds/"+this.data.attributes.round_id+"/fishes")},a}(i.a),k=function(t){function a(){for(var a,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return v(g(a=t.call.apply(t,[this].concat(e))||this),"catch_count",i.a.attribute("catch_count")),v(g(a),"user",i.a.hasOne("user")),a}return Object(y.a)(a,t),a}(i.a),w=function(t){function a(){for(var a,n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];return v(g(a=t.call.apply(t,[this].concat(e))||this),"name",i.a.attribute("name")),v(g(a),"starts_at",i.a.attribute("starts_at")),v(g(a),"ends_at",i.a.attribute("ends_at")),v(g(a),"include_starting_pack",i.a.attribute("include_starting_pack")),v(g(a),"ranking",i.a.hasOne("ranking")),a}return Object(y.a)(a,t),a.prototype.apiEndpoint=function(){return"/catch-the-fish/rounds"+(this.exists?"/"+this.data.id:"")},a}(i.a),F=n(4),T=n(16),x=n.n(T),O=n(7),_=n.n(O),P=function(){function t(){}return t.prototype.view=function(t){var a=t.attrs.fish.image_url();return a?m("img.catchthefish-image",{alt:_()(r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.fish-image.alt",{name:t.attrs.fish.name()})),src:a,style:{animationDuration:t.attrs.animationDuration||"10s"}}):m(".catchthefish-no-image",r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.fish-image.missing"))},t}(),B=function(){function t(){}return t.prototype.view=function(){if(!r.a.session.user)return m("div");var t=r.a.session.user.catchTheFishBasket();if(!t)return m("div");var a=t.filter((function(t){return t.canPlace()}));return 0===a.length?m("div"):m(".catchthefish-basket",[m(".catchthefish-basket-title",r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.basket.title")),m("p",r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.basket.drag-help")),a.map((function(t){return m(".catchthefish-basket-entry",[m(".catchthefish-basket-fish",{draggable:!0,ondragstart:function(a){a.dataTransfer.setData("text/plain","fish:"+t.id())}},m(P,{fish:t})),m(".catchthefish-basket-time",r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.basket.time",{time:dayjs(t.placeUntil()).fromNow()}))])}))])},t}(),D=n(17),A=n.n(D),N=n(18),R=n.n(N),j=n(19),M=n.n(j),S=function(){function t(){}return t.prototype.view=function(){return m(".catchthefish-drop-area",r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.drop-area.message"))},t}(),C=n(20),I=n.n(C),U=n(5),E=n.n(U),q=n(3),G=n.n(q),Y=n(21),L=n.n(Y),W=n(22),z=n.n(W),H=n(23),J=n.n(H),K=function(){function t(){}return t.prototype.view=function(t){var a=t.attrs.user;return m(L.a,{href:r.a.route.user(a)},[z()(a)," ",J()(a)])},t}(),Q="clarkwinkelmann-catch-the-fish.forum.caught-fish-modal.",V=function(t){function a(){return t.apply(this,arguments)||this}Object(y.a)(a,t);var n=a.prototype;return n.oninit=function(a){t.prototype.oninit.call(this,a),this.newName=this.attrs.fish.name(),this.dirty=!1,this.loading=!1},n.className=function(){return"Modal--small catchthefish-catch-modal"},n.title=function(){return r.a.translator.trans(Q+"title")},n.saveNameAndPlacement=function(t){var a=this;void 0===t&&(t=!1);var n={};this.dirty&&(n.name=this.newName),t&&(n.placement="random"),n?(this.loading=!0,r.a.request({method:"POST",url:r.a.forum.attribute("apiUrl")+"/catch-the-fish/fishes/"+this.attrs.fish.id()+"/place",body:n}).then((function(n){r.a.store.pushPayload(n),a.hide(),a.attrs.fish.canPlace()&&!t&&r.a.store.find("users",r.a.session.user.id()).then((function(){m.redraw()}))})).catch((function(t){throw a.loading=!1,m.redraw(),t}))):(this.hide(),this.attrs.fish.canPlace()&&!t&&r.a.store.find("users",r.a.session.user.id()).then((function(){m.redraw()})))},n.content=function(){var t=this,a=this.attrs.fish,n=a.namedBy(),e=a.placedBy();return m(".Modal-body",[m("h3",'"'+a.name()+'"'),m(P,{fish:a}),n?m("p",[r.a.translator.trans(Q+"named-by")," ",m(K,{user:n})]):null,e?m("p",[r.a.translator.trans(Q+"placed-by")," ",m(K,{user:e})]):null,m("p",r.a.translator.trans(Q+"congratulation",{catch_count:a.round().ranking().catch_count()})),a.canName()?m(".Form-group",[m("p",r.a.translator.trans(Q+"name-help")),m("label",r.a.translator.trans(Q+"name")),m("input.FormControl",{value:this.newName,oninput:m.withAttr("value",(function(a){t.newName=a,t.dirty=!0}))})]):null,a.canPlace()?m("p",r.a.translator.trans(Q+"placement-help")):null,m(".Form-group",G.a.component({className:"Button Button--primary Button--block",type:"button",loading:this.loading,onclick:function(){t.saveNameAndPlacement()}},r.a.translator.trans(Q+(this.dirty?a.canPlace()?"submit-name-place-later":"submit-name":a.canPlace()?"submit-place-later":"submit-continue")))),a.canPlace()?m(".Form-group",G.a.component({className:"Button Button--primary Button--block",type:"button",loading:this.loading,onclick:function(){t.saveNameAndPlacement(!0)}},r.a.translator.trans(Q+(this.dirty?"submit-name-place-random":"submit-place-random")))):null])},n.onsubmit=function(t){t.preventDefault(),this.saveNameAndPlacement()},a}(E.a),X=function(){function t(){}var a=t.prototype;return a.init=function(){this.reverseAnimation=Math.random()>.5,this.animationDuration=5+Math.floor(70*Math.random())/10+"s"},a.view=function(t){var a=t.attrs.fish;return m(".catchthefish-moving-fish",{className:I()({"catchthefish-animate-flip":r.a.forum.catchTheFishAnimateFlip(),"catchthefish-animate-reverse":this.reverseAnimation}),style:{animationDuration:this.animationDuration},onclick:function(){a.canCatch()||r.a.session.user?r.a.request({method:"POST",url:r.a.forum.attribute("apiUrl")+"/catch-the-fish/fishes/"+a.id()+"/catch",body:a.placement()}).then((function(a){r.a.modal.show(V,{fish:r.a.store.pushPayload(a)}),t.attrs.oncatch&&t.attrs.oncatch()})):alert(r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.moving-fish.login"))}},[m(".catchthefish-name",a.name()),m(P,{fish:a,animationDuration:this.animationDuration})])},t}();function Z(t){var a=t.dataTransfer.getData("text/plain"),n=/^fish:([0-9]+)$/.exec(a);return n?n[1]:null}function tt(t,a){var n=[];t&&n.push(m(S));var e=a.catchTheFishFishes();return e&&e.forEach((function(t){t.canSee()&&n.push(m(X,{fish:t,oncatch:function(){a.pushData({relationships:{catchTheFishFishes:{data:a.data.relationships.catchTheFishFishes.data.filter((function(a){return a.id!==t.id()}))}}})}}))})),n}function at(t,a){var n=this;t.ondrop=function(t){n.fishDragOver=!1;var e=Z(t);if(e){t.preventDefault();var o=r.a.store.getById("catchthefish-fishes",e);if(o){var i={};i[a+"_id"]=n.attrs[a].id(),r.a.request({method:"POST",url:r.a.forum.attribute("apiUrl")+"/catch-the-fish/fishes/"+o.id()+"/place",body:{placement:i}}).then((function(t){r.a.store.pushPayload(t),r.a.store.find("users",r.a.session.user.id()).then((function(){m.redraw()}))}))}else alert(r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.drop-area.missing-from-store"))}},t.ondragover=function(t){Z(t)&&(t.preventDefault(),t.dataTransfer.dropEffect="move",n.fishDragOver=!0)},t.ondragenter=function(t){t.preventDefault()},t.ondragleave=function(){n.fishDragOver=!1}}function nt(t,a,n){"content"===a?Object(F.override)(t,a,(function(t){return t().concat(tt(this.fishDragOver,this.attrs[n]))})):Object(F.extend)(t,a,(function(t){t.add("catchthefish-fish-and-drop",tt(this.fishDragOver,this.attrs[n]))})),Object(F.extend)(t,"oninit",(function(){var t=this;this.fishDragOver=!1,this.subtree&&this.subtree.check((function(){return t.fishDragOver}))})),"content"===a?Object(F.extend)(t,"elementAttrs",(function(t){at.bind(this)(t,n)})):Object(F.extend)(t,"view",(function(t){t.attrs=t.attrs||{},at.bind(this)(t.attrs,n)}))}var et=n(8),rt=n.n(et),ot="clarkwinkelmann-catch-the-fish.forum.table-ranking.",it=function(){function t(){}var a=t.prototype;return a.oninit=function(t){var a=this;this.rankings=null,r.a.request({method:"GET",url:r.a.forum.attribute("apiUrl")+"/catch-the-fish/rounds/"+t.attrs.round.id()+"/rankings"}).then((function(t){a.rankings=r.a.store.pushPayload(t),m.redraw()}))},a.view=function(t){return null===this.rankings?m("p",r.a.translator.trans(ot+"loading")):m("div",[m("h2",r.a.translator.trans(ot+"title",{name:t.attrs.round.name()})),m("table.catchthefish-table",[m("thead",m("tr",[m("th",r.a.translator.trans(ot+"rank")),m("th",r.a.translator.trans(ot+"count")),m("th",r.a.translator.trans(ot+"user"))])),m("tbody",this.rankings.map((function(t,a){return m("tr",[m("td","#"+(a+1)),m("td",t.catch_count()),m("td",m(K,{user:t.user()}))])})))])])},t}(),st=function(t){function a(){return t.apply(this,arguments)||this}return Object(y.a)(a,t),a.prototype.view=function(){if(!r.a.forum.catchTheFishCanSeeRankingsPage())return m(".container",m("p",r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.page-ranking.permission")));var t=r.a.forum.catchTheFishActiveRounds();return m(".container",[m("h2",r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.page-ranking.title")),t?t.map((function(t){return m(it,{round:t})})):m("p",r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.page-ranking.nothing"))])},a}(rt.a),ct=n(6),ut=n.n(ct),ht=n(9),lt=n.n(ht),mt=n(12),ft=n.n(mt),dt="clarkwinkelmann-catch-the-fish.forum.edit-round.",pt=function(){function t(){}var a=t.prototype;return a.oninit=function(t){this.round=t.attrs.round,this.dirty=!1,this.processing=!1,void 0===this.round&&(this.round=r.a.store.createRecord("catchthefish-rounds",{attributes:{name:"",starts_at:"",ends_at:dayjs().add(1,"day").toISOString(),include_starting_pack:!0}}))},a.view=function(t){var a=this;return m("form",{onsubmit:function(n){n.preventDefault(),a.saveRecord(t)}},[m(".Form-group",[m("label",r.a.translator.trans(dt+"name")),m("input.FormControl",{value:this.round.name(),oninput:ft()("value",this.updateAttribute.bind(this,"name"))}),m(".helpText",r.a.translator.trans(dt+"name-help"))]),m(".Form-group",[m("label",r.a.translator.trans(dt+"starts-at")),m("input.FormControl",{value:this.round.starts_at(),oninput:ft()("value",this.updateAttribute.bind(this,"starts_at"))})]),m(".Form-group",[m("label",r.a.translator.trans(dt+"ends-at")),m("input.FormControl",{value:this.round.ends_at(),oninput:ft()("value",this.updateAttribute.bind(this,"ends_at"))})]),this.round.exists?"":m(".Form-group",[m("label",[lt.a.component({state:this.round.include_starting_pack(),onchange:this.updateAttribute.bind(this,"include_starting_pack")},r.a.translator.trans(dt+"starting-pack"))]),m(".helpText",r.a.translator.trans(dt+"starting-pack-help"))]),m(".ButtonGroup",[G.a.component({type:"submit",className:"Button Button--primary",loading:this.processing,disabled:!this.readyToSave()},r.a.translator.trans(dt+(this.round.exists?"save":"create"))),this.round.exists?G.a.component({type:"button",className:"Button Button--danger",loading:this.processing,onclick:function(){a.deleteRecord(t)}},r.a.translator.trans(dt+"delete")):""])])},a.updateAttribute=function(t,a){var n;this.round.pushAttributes(((n={})[t]=a,n)),this.dirty=!0},a.readyToSave=function(){return!!this.round.name()&&this.dirty},a.saveRecord=function(t){var a=this;this.processing=!0,this.round.save(this.round.data.attributes).then((function(){t.attrs.onsave&&t.attrs.onsave(),a.processing=!1,a.dirty=!1,m.redraw()})).catch((function(t){throw a.processing=!1,m.redraw(),t}))},a.deleteRecord=function(t){var a=this;confirm(_()(r.a.translator.trans(dt+"delete-confirmation",{name:this.round.name()})))&&(this.processing=!0,this.round.delete().then((function(){t.attrs.ondelete&&t.attrs.ondelete(),a.processing=!1,m.redraw()})).catch((function(t){throw a.processing=!1,m.redraw(),t})))},t}(),gt=function(t){function a(){return t.apply(this,arguments)||this}Object(y.a)(a,t);var n=a.prototype;return n.className=function(){return"Modal--small"},n.title=function(){return r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.new-round-modal.title")},n.content=function(){var t=this;return m(".Modal-body",m(pt,{onsave:function(){t.hide(),t.attrs.oncreateordelete&&t.attrs.oncreateordelete()}}))},a}(E.a),yt=function(t){function a(){return t.apply(this,arguments)||this}Object(y.a)(a,t);var n=a.prototype;return n.className=function(){return"Modal--small"},n.title=function(){return r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.edit-round-modal.title",{name:this.attrs.round.name()})},n.content=function(){var t=this;return m(".Modal-body",m(pt,{round:this.attrs.round,ondelete:function(){t.hide(),t.attrs.oncreateordelete&&t.attrs.oncreateordelete()}}))},a}(E.a),vt="clarkwinkelmann-catch-the-fish.forum.table-round.",bt=function(t){function a(){return t.apply(this,arguments)||this}Object(y.a)(a,t);var n=a.prototype;return n.oninit=function(a){t.prototype.oninit.call(this,a),this.refreshRounds()},n.refreshRounds=function(){var t=this;this.rounds=null,r.a.request({method:"GET",url:r.a.forum.attribute("apiUrl")+"/catch-the-fish/rounds"}).then((function(a){t.rounds=r.a.store.pushPayload(a),m.redraw()}))},n.view=function(){var t=this;return null===this.rounds?m(".container",m("p",r.a.translator.trans(vt+"loading"))):m(".container",[m("h2",r.a.translator.trans(vt+"title")),G.a.component({className:"Button Button--primary",onclick:function(){r.a.modal.show(gt,{oncreateordelete:function(){t.refreshRounds()}})}},r.a.translator.trans(vt+"new")),m("table.catchthefish-table",[m("thead",m("tr",[m("th",r.a.translator.trans(vt+"name")),m("th",r.a.translator.trans(vt+"start")),m("th",r.a.translator.trans(vt+"end")),m("th",r.a.translator.trans(vt+"actions"))])),m("tbody",this.rounds.map((function(a){return m("tr",[m("td",a.name()),m("td",a.starts_at()),m("td",a.ends_at()),m("td",[G.a.component({className:"Button",onclick:function(){r.a.modal.show(yt,{round:a,oncreateordelete:function(){t.refreshRounds()}})}},r.a.translator.trans(vt+"edit"))," ",ut.a.component({className:"Button",href:r.a.route("catchTheFishRound",{id:a.id()})},r.a.translator.trans(vt+"fishes"))])])})))])])},a}(rt.a),kt="clarkwinkelmann-catch-the-fish.forum.edit-fish.",wt=function(){function t(){}var a=t.prototype;return a.oninit=function(t){this.fish=t.attrs.fish,this.dirty=!1,this.processing=!1,void 0===this.fish&&(this.fish=r.a.store.createRecord("catchthefish-fishes",{attributes:{round_id:t.attrs.round.id(),name:""}}))},a.view=function(t){var a=this;return m("form",{onsubmit:function(n){n.preventDefault(),a.saveRecord(t)}},[m(".Form-group",[m("label",r.a.translator.trans(kt+"name")),m("input.FormControl",{value:this.fish.name(),oninput:function(t){a.fish.pushAttributes({name:t.target.value}),a.dirty=!0}}),m(".helpText",r.a.translator.trans(kt+"name-help"))]),m(".ButtonGroup",[G.a.component({type:"submit",className:"Button Button--primary",loading:this.processing,disabled:!this.readyToSave()},r.a.translator.trans(kt+(this.fish.exists?"save":"create"))),this.fish.exists?G.a.component({type:"button",className:"Button Button--danger",loading:this.processing,onclick:function(){a.deleteRecord(t)}},r.a.translator.trans(kt+"delete")):""])])},a.readyToSave=function(){return!!this.fish.name()&&this.dirty},a.saveRecord=function(t){var a=this;this.processing=!0,this.fish.save(this.fish.data.attributes).then((function(){t.attrs.onsave&&t.attrs.onsave(),a.processing=!1,a.dirty=!1,m.redraw()})).catch((function(t){throw a.processing=!1,m.redraw(),t}))},a.deleteRecord=function(t){var a=this;confirm(_()(r.a.translator.trans(kt+"delete-confirmation",{name:this.fish.name()})))&&(this.processing=!0,this.fish.delete().then((function(){t.attrs.ondelete&&t.attrs.ondelete(),a.processing=!1,m.redraw()})).catch((function(t){throw a.processing=!1,m.redraw(),t})))},t}(),Ft=function(t){function a(){return t.apply(this,arguments)||this}Object(y.a)(a,t);var n=a.prototype;return n.className=function(){return"Modal--small"},n.title=function(){return r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.new-fish-modal.title")},n.content=function(){var t=this;return m(".Modal-body",m(wt,{round:this.attrs.round,onsave:function(){t.hide(),t.attrs.oncreateordelete&&t.attrs.oncreateordelete()}}))},a}(E.a),Tt=function(t){function a(){return t.apply(this,arguments)||this}Object(y.a)(a,t);var n=a.prototype;return n.className=function(){return"Modal--small"},n.title=function(){return r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.edit-fish-modal.title",{name:this.attrs.fish.name()})},n.content=function(){var t=this;return m(".Modal-body",m(wt,{fish:this.attrs.fish,ondelete:function(){t.hide(),t.attrs.oncreateordelete&&t.attrs.oncreateordelete()}}))},a}(E.a),xt="clarkwinkelmann-catch-the-fish.forum.table-fish.",Ot=function(t){function a(){return t.apply(this,arguments)||this}Object(y.a)(a,t);var n=a.prototype;return n.oninit=function(a){var n=this;t.prototype.oninit.call(this,a),this.roundId=m.route.param("id"),this.round=r.a.store.getById("catchthefish-round",this.roundId),this.round||r.a.store.find("catch-the-fish/rounds",this.roundId).then((function(t){n.round=t,m.redraw()})),this.uploading=!1,this.refreshFishes()},n.refreshFishes=function(){var t=this;this.fishes=null,r.a.request({method:"GET",url:r.a.forum.attribute("apiUrl")+"/catch-the-fish/rounds/"+this.roundId+"/fishes"}).then((function(a){t.fishes=r.a.store.pushPayload(a),m.redraw()}))},n.openPicker=function(t,a){if(void 0===a&&(a=!1),!this.uploading){var n=$('<input type="file">');n.attr("multiple",a),n.appendTo("body").hide().click().on("change",(function(a){t($(a.target)[0].files)}))}},n.uploadImages=function(t,a){var n=this,e=new FormData;if(a)e.append("image",t[0]);else for(var o=0;o<t.length;o++)e.append("image"+o,t[o]);this.uploading=!0,m.redraw(),r.a.request({method:"POST",url:r.a.forum.attribute("apiUrl")+"/catch-the-fish/"+(a?"fishes/"+a.id()+"/image":"rounds/"+this.roundId+"/fishes-from-images"),serialize:function(t){return t},body:e}).then((function(){n.uploading=!1,m.redraw(),n.refreshFishes()})).catch((function(t){throw n.uploading=!1,m.redraw(),t}))},n.view=function(){var t=this;return this.round&&null!==this.fishes?m(".container",[m("h2",r.a.translator.trans(xt+"title",{name:this.round.name()})),G.a.component({className:"Button Button--primary",onclick:function(){r.a.modal.show(Ft,{round:t.round,oncreateordelete:function(){t.refreshFishes()}})}},r.a.translator.trans(xt+"new"))," ",G.a.component({className:"Button",type:"button",onclick:function(){t.openPicker((function(a){t.uploadImages(a)}),!0)},loading:this.uploading},r.a.translator.trans(xt+"new-from-image")),m("table.catchthefish-table",[m("thead",m("tr",[m("th",r.a.translator.trans(xt+"image")),m("th",r.a.translator.trans(xt+"name")),m("th",r.a.translator.trans(xt+"user-name")),m("th",r.a.translator.trans(xt+"user-place")),m("th",r.a.translator.trans(xt+"actions"))])),m("tbody",0===this.fishes.length?m("tr",[m("td","No fishes")]):this.fishes.map((function(a){return m("tr",[m("td",m(P,{fish:a})),m("td",a.name()),m("td",a.namedBy()?m(K,{user:a.namedBy()}):m("em",r.a.translator.trans(xt+"no-user-name"))),m("td",a.placedBy()?m(K,{user:a.placedBy()}):m("em",r.a.translator.trans(xt+"no-user-place"))),m("td",[G.a.component({className:"Button",onclick:function(){r.a.modal.show(Tt,{fish:a,oncreateordelete:function(){t.refreshFishes()}})}},r.a.translator.trans(xt+"edit"))," ",G.a.component({className:"Button",type:"button",onclick:function(){t.openPicker((function(n){t.uploadImages(n,a)}))},loading:t.uploading},r.a.translator.trans(xt+"upload"))])])})))])]):m(".container",m("p",r.a.translator.trans(xt+"loading")))},a}(rt.a),_t=n(11),Pt=n.n(_t),Bt=function(){function t(){}return t.prototype.view=function(t){return m(".Alert.Alert-info",m(".container",[m("span.Alert-body",[r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.round-alert.message",{name:t.attrs.round.name(),time:dayjs(t.attrs.round.ends_at()).calendar()})]),r.a.forum.catchTheFishCanSeeRankingsPage()?m("ul.Alert-controls",m("li",ut.a.component({href:r.a.route("catchTheFishRankings")},r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.round-alert.rankings")))):null]))},t}(),Dt=n(24),At=n.n(Dt);dayjs.extend(At.a),r.a.initializers.add("clarkwinkelmann-catch-the-fish",(function(){r.a.store.models["catchthefish-fishes"]=b,r.a.store.models["catchthefish-rankings"]=k,r.a.store.models["catchthefish-rounds"]=w,c.a.prototype.catchTheFishFishes=i.a.hasMany("catchTheFishFishes"),h.a.prototype.catchTheFishFishes=i.a.hasMany("catchTheFishFishes"),f.a.prototype.catchTheFishFishes=i.a.hasMany("catchTheFishFishes"),f.a.prototype.catchTheFishBasket=i.a.hasMany("catchTheFishBasket"),p.a.prototype.catchTheFishActiveRounds=i.a.hasMany("catchTheFishActiveRounds"),p.a.prototype.catchTheFishCanModerate=i.a.attribute("catchTheFishCanModerate"),p.a.prototype.catchTheFishCanSeeRankingsPage=i.a.attribute("catchTheFishCanSeeRankingsPage"),p.a.prototype.catchTheFishCanSeeProfileRankings=i.a.attribute("catchTheFishCanSeeProfileRankings"),p.a.prototype.catchTheFishAnimateFlip=i.a.attribute("catchTheFishAnimateFlip"),Object(F.extend)(x.a.prototype,"items",(function(t){t.add("catchthefish-basket",m(B))})),nt(A.a.prototype,"content","post"),nt(R.a.prototype,"infoItems","user"),nt(M.a.prototype,"items","discussion"),r.a.routes.catchTheFishRankings={path:"/catch-the-fish",component:st},r.a.routes.catchTheFishRounds={path:"/catch-the-fish/rounds",component:bt},r.a.routes.catchTheFishRound={path:"/catch-the-fish/rounds/:id",component:Ot},Object(F.extend)(Pt.a.prototype,"navItems",(function(t){r.a.forum.catchTheFishCanSeeRankingsPage()&&t.add("catchthefish-rankings",ut.a.component({icon:"fas fa-fish",href:r.a.route("catchTheFishRankings")},r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.nav.rankings"))),r.a.forum.catchTheFishCanModerate()&&t.add("catchthefish-settings",ut.a.component({icon:"fas fa-fish",href:r.a.route("catchTheFishRounds")},r.a.translator.trans("clarkwinkelmann-catch-the-fish.forum.nav.settings")))})),Object(F.override)(Pt.a.prototype,"hero",(function(t){var a=t(),n=r.a.forum.catchTheFishActiveRounds();if(!n)return a;var e=n.map((function(t){return t?m(Bt,{round:t}):null}));return Array.isArray(a)?n.concat(a):m("div",[e,a])}))}))}]);
//# sourceMappingURL=forum.js.map